<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog Post</title>
  <link rel="stylesheet" href="style.css">
  
  <!-- Correct CDN for marked -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/15.0.7/marked.min.js" integrity="sha512-rPuOZPx/WHMHNx2RoALKwiCDiDrCo4ekUctyTYKzBo8NGA79NcTW2gfrbcCL2RYL7RdjX2v9zR0fKyI4U4kPew==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <header>
    <h1>My Blog</h1>
  </header>

  <section id="post-content">
    <!-- Post content will be injected here by JavaScript -->
  </section>

  <script>
    // Function to load a single post's content
    function loadSinglePost(postFile) {
      fetch(postFile)
        .then(response => response.text())
        .then(markdown => {
          // Split the markdown to get the front matter and content
          const frontMatterEndIndex = markdown.indexOf('---', 3); // Find the end of front matter section
          const frontMatter = markdown.slice(0, frontMatterEndIndex); // Extract front matter
          const content = markdown.slice(frontMatterEndIndex + 3).trim(); // Extract content (markdown without front matter)

          // Now, parse the markdown content only (not the front matter)
          const postContent = marked.parse(content); // Use 'marked.parse' for version 15+
          
          // Optional: Extract front matter fields (title, date, etc.)
          const frontMatterData = parseFrontMatter(frontMatter);
          
          // Render the post content with metadata (if needed)
          document.getElementById('post-content').innerHTML = `
            <div class="container">
              <img src="${frontMatterData.featured_image}" alt="${frontMatterData.title}">
              <h1>${frontMatterData.title}</h1>
              <p  class="date"> ${frontMatterData.date}</p>
              <div  class="content">${postContent}</div>
              <a href="blog.html" class="back-button">Back to Blog</a>
            </div>
          `;

          // Set up the back button
          document.getElementById('back-button').addEventListener('click', () => {
            window.history.back(); // Go back to the previous page
          });
        })
        .catch(error => console.error('Error loading post:', error));
    }

    // Helper function to parse front matter data (basic version)
    function parseFrontMatter(frontMatter) {
      const lines = frontMatter.split('\n');
      const data = {};

      lines.forEach(line => {
        const match = line.match(/(\w+):\s*(.*)/);
        if (match) {
          const key = match[1].trim();
          const value = match[2].trim();
          data[key] = value;
        }
      });

      return data;
    }

    // Parse the URL and fetch the corresponding post
    window.onload = () => {
      const urlParams = new URLSearchParams(window.location.search);
      const postFile = urlParams.get('post'); // Get the post file from the query parameter
      if (postFile) {
        loadSinglePost(postFile);  // Load the content for the post
      } else {
        document.getElementById('post-content').innerHTML = `<p>No post found.</p>`; // If no post param, show an error message
      }
    }
  </script>

  <footer>
    <p>&copy; 2025 My Blog</p>
  </footer>
</body>
</html>
